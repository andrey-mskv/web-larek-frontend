# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Описание проекта

Проект "Web-larek" представляет собой пример стандартного онлайн-магазина, ориентированного на продажу виртуальных товаров. Он предоставляет пользователям возможность просматривать каталог товаров, выбирать нужные позиции и оформлять заказы. Проект разработан на языке TypeScript и использует API для получения информации о товарах.

## Данные и типы данных, используемые в приложении

Карточка товара
```typescript
interface IItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number;
}
```
Корзина
```typescript
interface IBasketData {
	total: number;
	items: IItem[] | null;
}
```
Заказ
```typescript
interface IOrder {
	payment: string;
	email: string;
	phone: string;
	address: string;
	total: number;
	items: IItem[]; 
}
```
Интерфейс модели данных товаров
```typescript
export interface IItemsData {
  items: IItem[];
  preview: string | null;
	addItem(card: IItem): void;
	getItem(cardId: string): IItem;
}
```
Данные карточки товара для главной страницы, подробной иформации и списка заказа

```typescript
export type TItemList = Pick<IItem,'image' | 'title' | 'category' | 'price'>;

export type TItemPreview = Pick<IItem, 'description'> & TItemList;

export type TItemOrder = Pick<IItem, 'title' | 'price'>;
```
Данные корзины

```typescript
export type TBasket = Pick<IOrder, 'items' | 'total'>;
```
Данные в формах заказа
```typescript
export type TOrderFirstStep = Pick<IOrder, 'address' | 'payment'>;
export type TOrderSecondStep = Pick<IOrder, 'email' | 'phone'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления - отображение данных на странице, 
- слой данных - хранение и изменение данных
- презентер - связь слоев 'представления' и 'данных'.

### Базовый код
***
#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие  

### Слой даннх
***

#### Класс ItemsData
Класс отвечает за хранение карточек товаров.\
Конструктор класса принимает аргумент брокера событий\
В полях класса хранятся следующие данные:
- `_items: IItems[]` - массив объектов товаров
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- `_preview: string `- хранение id элемента для предпросмотра

- `addItem(card: IItem): void `- добавление товара в начало массива
- `getItem(cardId: string): IItem `возвращает товар по id (для превью/добавления в корзинy)
- сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс BackerData
Отвечает за храниение и логику работы с данными 'корзины'\
Конструктор класса принимает аргумент брокера событий\
Поля класса:
- `_total: number` - количество товаров в корзине
- `_items: IItem[]` - список товаров в корзине

- `getItemsId()` - вовзращает массив id элементов товаров
- `getTotal()` - в зависимости от того, есть ли в корзине 'бесценные' элементы (isItemsPriceNull()), возвращает общую стоимость товаров (calcTotal()) или предупреждает о невозможности оформить заказ.
- `getCount()` - считает количество товаров в корзине
- `addToBasket(item: Partial<IItem>)` - добавляет товар при условии его отсутствия в списке корзины `isItemInBasket(item: IItem)`
- `deleteFromBasket(item: Partial<IItem>)` - удаляет товар из корзины
- `cleanBasket() `- очищает корзину

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными заказа.\
Конструктор класса принимает аргумент брокера событий\
В полях класса хранятся следующие данные:
- `_order: IOrder`- объект данных о заказе (c пустыми полями и нулевыми значениям по-умолчанию), включающий в себя список id выбранных товаров, контактные данные, способ оплаты и общую стоимость.

- `cleanOrder()` - удаление данных заказа
- `setOrederParams(field: keyof IOrderForm, value: string)` - заполняет значения свойств объекта заказа IOrder используя значения инпутов и выбора 'способа оплаты' пользователем.
- `validateOrder(field: keyof IOrderForm)` - проверяет вводимые данные с расширенной логикой в `validateField(field: keyof IOrderForm, value: string)` и изменяет поле formErrors
- `validTextInput(input: string), validEmailInput(input: string), validPhoneInput(input: string)` - шаблоны для инпутов.
- `cleanErrors()` - уадаление ошибок
- `getErrorsValues()` - получения форматированного списка значений ошибок
- `getOrderValid()`, `getContactValid()` - проверка валидности заполненных данных

- set & get для сохранения и получения данных из полей класса.

### Классы представления

#### Класс Modal
Наследуется от родительского класса Components. Реализует модальное окно.
Методы `open`, `close` - для управления отображением окна и элементом разметки. Устанавливает слушатели на на клик в оверлей и кнопку-крестик для закрытия попапа. Метод `handleEscUp` - используется в качестве слушателя для кнопки `esc`. Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- `_closeButton: HTMLButtonElement` - кнопка закрытия
- `_content: HTMLElemen` - элемент модального окна

#### Класс Item
Предназначен для формирования разметки карточки товара на основе полученых данных: наименование товара, изображения, цены, категории и описания. Используется для отображения карточки на странице, в превью и в корзине. Вариативность разметки зависит от типа темплейта, передаваемого аргументом в конструктор класса. Вторым аргументом передается экземляр класса `EventEmitter` для инициации событий.\

Используемые методы:
- `setIndex(value: number)` - заполняет порядковый номер свойства itemIndex.
- `setCategoryColor(value: string)` - устанавливает цвет поля "катеогория" в соотсветствии с макетом
- `orderAble(status: boolean)` - переключает кнопку "В корзину" на disble.

#### Класс Page
Отвечает за отображение главной страницы. В конструктор принимает контейнер, в котором размещаются контент.\
- сеттер `gallery` - обновления галереи элементов товаров
- сеттер `counter` - обновления счетчика корзины
- сеттер `locked` - блокирует страницу

### Слой коммуникации

#### Класс AppApi
Наследуется от родительского класса Api ктор и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
Методы: 
- `getItems` - выполняет GET запрос на переданный в параметрах ендпоинт, возвращает промис с объектом, которым ответил сервер
- `getItem` - принимает строковое значение (id элемента), выполняет GET запрос, возвращает промис с объектом.
- `serOrder` - принимает объект с данными, которые будут переданы в JSON в теле POST запроса, отправляет эти данные на ендпоинт, возвращая ответ сервера.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В презентере создаются экземпляры всех необходимых классов: модели данных и представления, котейнеры, темплейты. Наастраивается обработка событий.

*События изменения данных (генерируются классами моделями данных)*
- `items:changed` - изменение массива выбранных товаров
- `basket:changed` - изменение состояния корзины
- `preview:changed `- изменение статуса выбранной карточки товара
- `formErrors:changed` - изменение массива ошибок
- `order:ready` - оповещение о валидном заполнении данных заказа
- `total:reseved` - получение ответа от сервера с суммой заказа

*События, возникающие при взаимодействии пользователя с интерфейсом*
- `item:select` - открытие превью товара
- `modal:open`, `modal:close` - отктырие/закрытие модального окна
- `basket:open` - открытие корзины
- `basket:add` - добавление товара в корзину
- `basket:delete` - удаление товара из корзины
- `order:select` - открытие окна заказа для выбора способа оплаты и ввода адреса
- `payment:select` - выбор способа оплаты
- `order.*.*:change`- изменение полей ввода формы заказа
- `order:submit`- подтверждение введенных данных, открытие окна для ввода контактов
- `contact:submit`- подтверждение введенных данных, подтверждение заказа

*Темплейты карточки товара*
- `card-catalog`
- `card-preview`
- `card-basket`

*Темплейты модальных окон*
- `basket`
- `order`
- `contacts`
- `success`